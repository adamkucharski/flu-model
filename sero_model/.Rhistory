theta=theta0
vp1=0.05 #probability individual infection history resampled
run_mcmc(test.yr=2010,runs=10000,hist.true=NULL,varpart_prob=vp1,test_years,inf_years,strain_years,n_part,test.list,theta0,switch1=2)
#historytabSim
# Plot posteriors and compare to simulation
source("simulation_diagnostics.R",local=TRUE)
# Model of serological dynamics - uses PLOS Biology model (Kucharski et al. 2015)
# Author: AJ Kucharski (2015)
# setwd("~/Documents/flu-model/sero_model/")
# setwd("./sero_model")
library(reshape2)
library(foreach)
library(doMC)
library(mvtnorm)
registerDoMC(4)  #change the 2 to your number of CPU cores
getDoParWorkers()
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
# Load data and functions (Fonville et al.)
#source("load_data.R")
source("sero_functions.R")
compile.c() # Compile c code
# logabs2(seq(-5, 5, by=2))
# - - - - - - - - - - - - -
# Generate simulated data
thetaSim=c(mu=4,tau1=0.1,tau2=0.1,sigma=0.3,wane=0.1)
npartM=100
simulate_data(test_years=seq(2010,2010),
inf_years=seq(1980,2010,1),
strain_years=seq(1980,2010,2),
n_part=npartM,thetastar=thetaSim,p.inf=0.1)
# Compile c code
compile.c<-function(){
require("Rcpp")
setwd("c_code")
system("R CMD SHLIB c_model2.c")
system("R CMD SHLIB c_model2_sr.c")
dyn.load("./c_model2.so")
dyn.load("./c_model2_sr.so")
sourceCpp("./cpp_steven.cpp")
setwd("..")
}
compile.c()
theta
compile.c()
compile.c()
# Model of serological dynamics - uses PLOS Biology model (Kucharski et al. 2015)
# Author: AJ Kucharski (2015)
# setwd("~/Documents/flu-model/sero_model/")
# setwd("./sero_model")
library(reshape2)
library(foreach)
library(doMC)
library(mvtnorm)
registerDoMC(4)  #change the 2 to your number of CPU cores
getDoParWorkers()
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
# Load data and functions (Fonville et al.)
#source("load_data.R")
source("sero_functions.R")
compile.c() # Compile c code
# logabs2(seq(-5, 5, by=2))
# - - - - - - - - - - - - -
# Generate simulated data
thetaSim=c(mu=4,tau1=0.1,tau2=0.1,sigma=0.3,wane=0.1)
npartM=100
simulate_data(test_years=seq(2010,2010),
inf_years=seq(1980,2010,1),
strain_years=seq(1980,2010,2),
n_part=npartM,thetastar=thetaSim,p.inf=0.1)
# Model of serological dynamics - uses PLOS Biology model (Kucharski et al. 2015)
# Author: AJ Kucharski (2015)
# setwd("~/Documents/flu-model/sero_model/")
# setwd("./sero_model")
library(reshape2)
library(foreach)
library(doMC)
library(mvtnorm)
registerDoMC(4)  #change the 2 to your number of CPU cores
getDoParWorkers()
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
# Load data and functions (Fonville et al.)
#source("load_data.R")
source("sero_functions.R")
compile.c() # Compile c code
# logabs2(seq(-5, 5, by=2))
# - - - - - - - - - - - - -
# Generate simulated data
thetaSim=c(mu=4,tau1=0.1,tau2=0.1,sigma=0.3,wane=0.1)
npartM=100
simulate_data(test_years=seq(2010,2010),
inf_years=seq(1980,2010,1),
strain_years=seq(1980,2010,2),
n_part=npartM,thetastar=thetaSim,p.inf=0.1)
# - - - - - - - - - - - - -
# Generate simulated data
thetaSim=c(mu=4,tau1=0.1,tau2=0.1,sigma=0.3,wane=0.1)
npartM=100
simulate_data(test_years=seq(2010,2010),
inf_years=seq(1980,2010,1),
strain_years=seq(1980,2010,2),
n_part=npartM,thetastar=thetaSim,p.inf=0.1)
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
# INFERENCE MODEL
# Run MCMC for specific data set
#load("R_datasets/HaNam_data.RData")
load("R_datasets/Simulated_data.RData")
# Plot simulation data vs history
source("simulation_plots.R")
# - - - - - - - - - - - - -
# Generate simulated data
thetaSim=c(mu=4,tau1=0.1,tau2=0.1,sigma=0.3,wane=0.1)
npartM=100
simulate_data(test_years=seq(2010,2010),
inf_years=seq(1980,2010,1),
strain_years=seq(1980,2010,2),
n_part=npartM,thetastar=thetaSim,p.inf=0.1)
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
# INFERENCE MODEL
# Run MCMC for specific data set
#load("R_datasets/HaNam_data.RData")
load("R_datasets/Simulated_data.RData")
# Plot simulation data vs history
source("simulation_plots.R")
# - - - - - - - - - - - - -
# Generate simulated data
thetaSim=c(mu=4,tau1=0.1,tau2=0.1,sigma=0.3,wane=0.1)
npartM=100
simulate_data(test_years=seq(2010,2010),
inf_years=seq(1980,2010,1),
strain_years=seq(1980,2010,2),
n_part=npartM,thetastar=thetaSim,p.inf=0.1)
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
# INFERENCE MODEL
# Run MCMC for specific data set
#load("R_datasets/HaNam_data.RData")
load("R_datasets/Simulated_data.RData")
# Plot simulation data vs history
source("simulation_plots.R")
# Set initial theta
theta0=c(mu=NA,tau1=NA,tau2=NA,sigma=NA,wane=NA)
theta0[["mu"]]=4
theta0[["sigma"]]=0.3
theta0[["tau1"]]=0.1
theta0[["tau2"]]=0.1
theta0[["wane"]]=0.1
theta=theta0
vp1=0.05 #probability individual infection history resampled
run_mcmc(test.yr=2010,runs=10000,hist.true=NULL,varpart_prob=vp1,test_years,inf_years,strain_years,n_part,test.list,theta0,switch1=2)
#historytabSim
# Plot posteriors and compare to simulation
source("simulation_diagnostics.R",local=TRUE)
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
# Simulation diagnostics
# Compare MCMC output to simulation data
load("posterior_sero_runs/outputR.RData")
par(mfrow=c(3,3))
par(mar = c(5,5,1,1))
colA=rgb(0.8,0.8,0.8)
# Plot profile likelihood
lik.tot=rowSums(likelihoodtab)
maxlik=max(lik.tot)
runsPOST=length(lik.tot[lik.tot!=-Inf])
runs1=ceiling(0.5*runsPOST)
plot(rowSums(likelihoodtab)[runs1:runsPOST],type="l",ylab="likelihood",ylim=c(maxlik-50,maxlik))
plot(as.data.frame(thetatab)$mu[1:runsPOST],type="l",ylab="mu")
plot(as.data.frame(thetatab)$sigma[1:runsPOST],type="l",ylab="sigma")
# Plot histogram of boosting
hist(as.data.frame(thetatab)$mu[runs1:runsPOST],main=NULL,col=colA,xlab="mu",prob=TRUE,xlim=c(1,5))
abline(v=thetaSim[["mu"]],col="red")
hist(as.data.frame(thetatab)$sigma[runs1:runsPOST],main=NULL,col=colA,xlab="sigma",xlim=c(0,0.5))
abline(v=thetaSim[["sigma"]],col="red")
hist(as.data.frame(thetatab)$tau1[runs1:runsPOST],main=NULL,col=colA,xlab="tau1",prob=TRUE,xlim=c(0,0.5))
abline(v=thetaSim[["tau1"]],col="red")
hist(as.data.frame(thetatab)$tau2[runs1:runsPOST],main=NULL,col=colA,xlab="tau2",prob=TRUE,xlim=c(0,0.5))
abline(v=thetaSim[["tau2"]],col="red")
plot(as.data.frame(thetatab)$tau1[runs1:runsPOST],as.data.frame(thetatab)$tau2[runs1:runsPOST],pch=18,xlab="tau1",ylab="tau2")
plot(rowSums(historytab-historytabSim),type="l",ylab="history residual")
dev.copy(pdf,paste("plot_simulations/posterior_mu",thetaSim[["mu"]],"_sigma",thetaSim[["sigma"]],"_npart",n_part,".pdf",sep=""),width=12,height=8)
dev.off()
# UPDATE THIS BIT
#Compare model fits using posterior infection history (historytabPost) and parameters
simulate_data(test_years,historytabPost=historytab,
inf_years,
strain_years,
n_part=npartM,thetastar=as.data.frame(thetatab)[runsPOST,],p.inf=0.1)
load("R_datasets/Simulated_dataPost.RData")
par(mfrow=c(2,5))
par(mar = c(5,5,1,1))
for(ii0 in 1:n_part){
lenhis=rep(0,length(historytabSim[ii0,]))
plot(8*historytabSim[ii0,],type="l",ylim=c(0,9),col='white')
#for(jj in 1:length(lenhis)){
#  lines(c(jj,jj),c(0,9*historytabSim[ii0,jj]),col='red')
#}
for(jj in 1:length(lenhis)){
lines(c(jj,jj),c(0,9*historytab[ii0,jj]),col='blue')
}
lines(test.list[[ii0]][[1]][4,],test.list[[ii0]][[1]][2,],type="l")
points(test.list[[ii0]][[1]][4,],test.list[[ii0]][[1]][2,],pch=19)
if(ii0 %% 10==0){
dev.copy(pdf,paste("plot_simulations/sim",ii0,"P.pdf",sep=""),width=12,height=6)
dev.off()
}
}
# - - - - - - - - - - - - -
# Generate simulated data
thetaSim=c(mu=4,tau1=0.1,tau2=0.1,sigma=0.3,wane=0.1)
npartM=100
simulate_data(test_years=seq(2010,2010),
inf_years=seq(1980,2010,1),
strain_years=seq(1980,2010,2),
n_part=npartM,thetastar=thetaSim,p.inf=0.1)
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
# INFERENCE MODEL
# Run MCMC for specific data set
#load("R_datasets/HaNam_data.RData")
load("R_datasets/Simulated_data.RData")
# Plot simulation data vs history
source("simulation_plots.R")
# - - - - - - - - - - - - -
# Generate simulated data
thetaSim=c(mu=4,tau1=0.5,tau2=0.1,sigma=0.3,wane=0.1)
npartM=100
simulate_data(test_years=seq(2010,2010),
inf_years=seq(1980,2010,1),
strain_years=seq(1980,2010,2),
n_part=npartM,thetastar=thetaSim,p.inf=0.1)
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
# INFERENCE MODEL
# Run MCMC for specific data set
#load("R_datasets/HaNam_data.RData")
load("R_datasets/Simulated_data.RData")
# Plot simulation data vs history
source("simulation_plots.R")
# - - - - - - - - - - - - -
# Generate simulated data
thetaSim=c(mu=4,tau1=0.3,tau2=0.1,sigma=0.3,wane=0.1)
npartM=100
simulate_data(test_years=seq(2010,2010),
inf_years=seq(1980,2010,1),
strain_years=seq(1980,2010,2),
n_part=npartM,thetastar=thetaSim,p.inf=0.1)
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
# INFERENCE MODEL
# Run MCMC for specific data set
#load("R_datasets/HaNam_data.RData")
load("R_datasets/Simulated_data.RData")
# Plot simulation data vs history
source("simulation_plots.R")
# Set initial theta
theta0=c(mu=NA,tau1=NA,tau2=NA,sigma=NA,wane=NA)
theta0[["mu"]]=4
theta0[["sigma"]]=0.3
theta0[["tau1"]]=0.1
theta0[["tau2"]]=0.1
theta0[["wane"]]=0.1
theta=theta0
vp1=0.05 #probability individual infection history resampled
run_mcmc(test.yr=2010,runs=10000,hist.true=NULL,varpart_prob=vp1,test_years,inf_years,strain_years,n_part,test.list,theta0,switch1=2)
#historytabSim
# Plot posteriors and compare to simulation
source("simulation_diagnostics.R",local=TRUE)
load("R_datasets/HaNam_data.RData")
# Set initial theta
theta0=c(mu=NA,tau1=NA,tau2=NA,sigma=NA,wane=NA)
theta0[["mu"]]=4
theta0[["sigma"]]=0.3
theta0[["tau1"]]=0.1
theta0[["tau2"]]=0.1
theta0[["wane"]]=0.1
theta=theta0
vp1=0.05 #probability individual infection history resampled
#run_mcmc(test.yr=2010,runs=10000,hist.true=NULL,varpart_prob=vp1,test_years,inf_years,strain_years,n_part,test.list,theta0,switch1=2)
#historytabSim
run_mcmc(test.yr=2010,runs=1000,hist.true=NULL,varpart_prob=vp1,test_years,inf_years,strain_years,n_part,test.list,theta0,switch1=2)
# Set initial theta
theta0=c(mu=NA,tau1=NA,tau2=NA,sigma=NA,wane=NA)
theta0[["mu"]]=4
theta0[["sigma"]]=0.3
theta0[["tau1"]]=0.1
theta0[["tau2"]]=0.1
theta0[["wane"]]=0.1
theta=theta0
vp1=0.05 #probability individual infection history resampled
#run_mcmc(test.yr=2010,runs=10000,hist.true=NULL,varpart_prob=vp1,test_years,inf_years,strain_years,n_part,test.list,theta0,switch1=2)
#historytabSim
run_mcmc(test.yr=2012,runs=1000,hist.true=NULL,varpart_prob=vp1,test_years,inf_years,strain_years,n_part,test.list,theta0,switch1=2)
test.list[[1]]
# Set initial theta
theta0=c(mu=NA,tau1=NA,tau2=NA,sigma=NA,wane=NA)
theta0[["mu"]]=4
theta0[["sigma"]]=0.3
theta0[["tau1"]]=0.1
theta0[["tau2"]]=0.1
theta0[["wane"]]=0.1
theta=theta0
vp1=0.05 #probability individual infection history resampled
#run_mcmc(test.yr=2010,runs=10000,hist.true=NULL,varpart_prob=vp1,test_years,inf_years,strain_years,n_part,test.list,theta0,switch1=2)
#historytabSim
run_mcmc(test.yr=2012,runs=1000,hist.true=NULL,varpart_prob=vp1,test_years,inf_years,strain_years,n_part,test.list,theta0,switch1=2)
# Plot posteriors and compare to simulation
source("simulation_diagnostics.R",local=TRUE)
load("R_datasets/Simulated_dataPost.RData")
par(mfrow=c(2,5))
par(mar = c(5,5,1,1))
for(ii0 in 1:n_part){
lenhis=rep(0,length(historytabSim[ii0,]))
plot(8*historytabSim[ii0,],type="l",ylim=c(0,9),col='white')
#for(jj in 1:length(lenhis)){
#  lines(c(jj,jj),c(0,9*historytabSim[ii0,jj]),col='red')
#}
for(jj in 1:length(lenhis)){
lines(c(jj,jj),c(0,9*historytab[ii0,jj]),col='blue')
}
lines(test.list[[ii0]][[1]][4,],test.list[[ii0]][[1]][2,],type="l")
points(test.list[[ii0]][[1]][4,],test.list[[ii0]][[1]][2,],pch=19)
if(ii0 %% 10==0){
dev.copy(pdf,paste("plot_simulations/sim",ii0,"P.pdf",sep=""),width=12,height=6)
dev.off()
}
}
# UPDATE THIS BIT
#Compare model fits using posterior infection history (historytabPost) and parameters
simulate_data(test_years,historytabPost=historytab,
inf_years,
strain_years,
n_part=npartM,thetastar=as.data.frame(thetatab)[runsPOST,],p.inf=0.1)
load("R_datasets/Simulated_dataPost.RData")
par(mfrow=c(2,5))
par(mar = c(5,5,1,1))
for(ii0 in 1:n_part){
lenhis=rep(0,length(historytabSim[ii0,]))
plot(8*historytabSim[ii0,],type="l",ylim=c(0,9),col='white')
#for(jj in 1:length(lenhis)){
#  lines(c(jj,jj),c(0,9*historytabSim[ii0,jj]),col='red')
#}
for(jj in 1:length(lenhis)){
lines(c(jj,jj),c(0,9*historytab[ii0,jj]),col='blue')
}
lines(test.list[[ii0]][[1]][4,],test.list[[ii0]][[1]][2,],type="l")
points(test.list[[ii0]][[1]][4,],test.list[[ii0]][[1]][2,],pch=19)
if(ii0 %% 10==0){
dev.copy(pdf,paste("plot_simulations/sim",ii0,"P.pdf",sep=""),width=12,height=6)
dev.off()
}
}
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
# Simulation diagnostics
# Compare MCMC output to simulation data
load("posterior_sero_runs/outputR.RData")
par(mfrow=c(3,3))
par(mar = c(5,5,1,1))
colA=rgb(0.8,0.8,0.8)
# Plot profile likelihood
lik.tot=rowSums(likelihoodtab)
maxlik=max(lik.tot)
runsPOST=length(lik.tot[lik.tot!=-Inf])
runs1=ceiling(0.5*runsPOST)
plot(rowSums(likelihoodtab)[runs1:runsPOST],type="l",ylab="likelihood",ylim=c(maxlik-50,maxlik))
plot(as.data.frame(thetatab)$mu[1:runsPOST],type="l",ylab="mu")
plot(as.data.frame(thetatab)$sigma[1:runsPOST],type="l",ylab="sigma")
# Plot histogram of boosting
hist(as.data.frame(thetatab)$mu[runs1:runsPOST],main=NULL,col=colA,xlab="mu",prob=TRUE,xlim=c(1,5))
if(simDat==T){abline(v=thetaSim[["mu"]],col="red")}
hist(as.data.frame(thetatab)$sigma[runs1:runsPOST],main=NULL,col=colA,xlab="sigma",xlim=c(0,0.5))
if(simDat==T){abline(v=thetaSim[["sigma"]],col="red")}
hist(as.data.frame(thetatab)$tau1[runs1:runsPOST],main=NULL,col=colA,xlab="tau1",prob=TRUE,xlim=c(0,0.5))
if(simDat==T){abline(v=thetaSim[["tau1"]],col="red")}
hist(as.data.frame(thetatab)$tau2[runs1:runsPOST],main=NULL,col=colA,xlab="tau2",prob=TRUE,xlim=c(0,0.5))
if(simDat==T){abline(v=thetaSim[["tau2"]],col="red")}
plot(as.data.frame(thetatab)$tau1[runs1:runsPOST],as.data.frame(thetatab)$tau2[runs1:runsPOST],pch=18,xlab="tau1",ylab="tau2")
if(simDat==T){plot(rowSums(historytab-historytabSim),type="l",ylab="history residual")}
dev.copy(pdf,paste("plot_simulations/posterior_mu",thetaSim[["mu"]],"_sigma",thetaSim[["sigma"]],"_npart",n_part,".pdf",sep=""),width=12,height=8)
dev.off()
if(simDat==T){
# UPDATE THIS BIT
#Compare model fits using posterior infection history (historytabPost) and parameters
simulate_data(test_years,historytabPost=historytab,
inf_years,
strain_years,
n_part=npartM,thetastar=as.data.frame(thetatab)[runsPOST,],p.inf=0.1)
load("R_datasets/Simulated_dataPost.RData")
par(mfrow=c(2,5))
par(mar = c(5,5,1,1))
for(ii0 in 1:n_part){
lenhis=rep(0,length(historytabSim[ii0,]))
plot(8*historytabSim[ii0,],type="l",ylim=c(0,9),col='white')
#for(jj in 1:length(lenhis)){
#  lines(c(jj,jj),c(0,9*historytabSim[ii0,jj]),col='red')
#}
for(jj in 1:length(lenhis)){
lines(c(jj,jj),c(0,9*historytab[ii0,jj]),col='blue')
}
lines(test.list[[ii0]][[1]][4,],test.list[[ii0]][[1]][2,],type="l")
points(test.list[[ii0]][[1]][4,],test.list[[ii0]][[1]][2,],pch=19)
if(ii0 %% 10==0){
dev.copy(pdf,paste("plot_simulations/sim",ii0,"P.pdf",sep=""),width=12,height=6)
dev.off()
}
}
}
simDat=FALSE
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
# Simulation diagnostics
# Compare MCMC output to simulation data
load("posterior_sero_runs/outputR.RData")
par(mfrow=c(3,3))
par(mar = c(5,5,1,1))
colA=rgb(0.8,0.8,0.8)
# Plot profile likelihood
lik.tot=rowSums(likelihoodtab)
maxlik=max(lik.tot)
runsPOST=length(lik.tot[lik.tot!=-Inf])
runs1=ceiling(0.5*runsPOST)
plot(rowSums(likelihoodtab)[runs1:runsPOST],type="l",ylab="likelihood",ylim=c(maxlik-50,maxlik))
plot(as.data.frame(thetatab)$mu[1:runsPOST],type="l",ylab="mu")
plot(as.data.frame(thetatab)$sigma[1:runsPOST],type="l",ylab="sigma")
# Plot histogram of boosting
hist(as.data.frame(thetatab)$mu[runs1:runsPOST],main=NULL,col=colA,xlab="mu",prob=TRUE,xlim=c(1,5))
if(simDat==T){abline(v=thetaSim[["mu"]],col="red")}
hist(as.data.frame(thetatab)$sigma[runs1:runsPOST],main=NULL,col=colA,xlab="sigma",xlim=c(0,0.5))
if(simDat==T){abline(v=thetaSim[["sigma"]],col="red")}
hist(as.data.frame(thetatab)$tau1[runs1:runsPOST],main=NULL,col=colA,xlab="tau1",prob=TRUE,xlim=c(0,0.5))
if(simDat==T){abline(v=thetaSim[["tau1"]],col="red")}
hist(as.data.frame(thetatab)$tau2[runs1:runsPOST],main=NULL,col=colA,xlab="tau2",prob=TRUE,xlim=c(0,0.5))
if(simDat==T){abline(v=thetaSim[["tau2"]],col="red")}
plot(as.data.frame(thetatab)$tau1[runs1:runsPOST],as.data.frame(thetatab)$tau2[runs1:runsPOST],pch=18,xlab="tau1",ylab="tau2")
if(simDat==T){plot(rowSums(historytab-historytabSim),type="l",ylab="history residual")}
dev.copy(pdf,paste("plot_simulations/posterior_mu",thetaSim[["mu"]],"_sigma",thetaSim[["sigma"]],"_npart",n_part,".pdf",sep=""),width=12,height=8)
dev.off()
if(simDat==T){
# UPDATE THIS BIT
#Compare model fits using posterior infection history (historytabPost) and parameters
simulate_data(test_years,historytabPost=historytab,
inf_years,
strain_years,
n_part=npartM,thetastar=as.data.frame(thetatab)[runsPOST,],p.inf=0.1)
load("R_datasets/Simulated_dataPost.RData")
par(mfrow=c(2,5))
par(mar = c(5,5,1,1))
for(ii0 in 1:n_part){
lenhis=rep(0,length(historytabSim[ii0,]))
plot(8*historytabSim[ii0,],type="l",ylim=c(0,9),col='white')
#for(jj in 1:length(lenhis)){
#  lines(c(jj,jj),c(0,9*historytabSim[ii0,jj]),col='red')
#}
for(jj in 1:length(lenhis)){
lines(c(jj,jj),c(0,9*historytab[ii0,jj]),col='blue')
}
lines(test.list[[ii0]][[1]][4,],test.list[[ii0]][[1]][2,],type="l")
points(test.list[[ii0]][[1]][4,],test.list[[ii0]][[1]][2,],pch=19)
if(ii0 %% 10==0){
dev.copy(pdf,paste("plot_simulations/sim",ii0,"P.pdf",sep=""),width=12,height=6)
dev.off()
}
}
}
# Plot simulation data vs history
#source("simulation_plots.R")
# Set initial theta
theta0=c(mu=NA,tau1=NA,tau2=NA,sigma=NA,wane=NA)
theta0[["mu"]]=4
theta0[["sigma"]]=0.3
theta0[["tau1"]]=0.2
theta0[["tau2"]]=0.2
theta0[["wane"]]=0.1
theta=theta0
vp1=0.05 #probability individual infection history resampled
#run_mcmc(test.yr=2010,runs=10000,hist.true=NULL,varpart_prob=vp1,test_years,inf_years,strain_years,n_part,test.list,theta0,switch1=2)
#historytabSim
run_mcmc(test.yr=2012,runs=5000,hist.true=NULL,varpart_prob=vp1,test_years,inf_years,strain_years,n_part,test.list,theta0,switch1=2)
# Plot posteriors and compare to simulation
simDat=FALSE
source("simulation_diagnostics.R",local=TRUE)
load("R_datasets/HaNam_data.RData")
#load("R_datasets/Simulated_data.RData")
# Plot simulation data vs history
#source("simulation_plots.R")
# Set initial theta
theta0=c(mu=NA,tau1=NA,tau2=NA,sigma=NA,wane=NA)
theta0[["mu"]]=4
theta0[["sigma"]]=0.3
theta0[["tau1"]]=0.2
theta0[["tau2"]]=0.2
theta0[["wane"]]=0.1
theta=theta0
vp1=0.05 #probability individual infection history resampled
#run_mcmc(test.yr=2010,runs=10000,hist.true=NULL,varpart_prob=vp1,test_years,inf_years,strain_years,n_part,test.list,theta0,switch1=2)
#historytabSim
run_mcmc(test.yr=2012,runs=5000,hist.true=NULL,varpart_prob=vp1,test_years,inf_years,strain_years,n_part,test.list,theta0,switch1=2)
# Plot posteriors and compare to simulation
simDat=FALSE
source("simulation_diagnostics.R",local=TRUE)
load("R_datasets/HaNam_data.RData")
#load("R_datasets/Simulated_data.RData")
# Plot simulation data vs history
#source("simulation_plots.R")
# Set initial theta
theta0=c(mu=NA,tau1=NA,tau2=NA,sigma=NA,wane=NA)
theta0[["mu"]]=4
theta0[["sigma"]]=0.3
theta0[["tau1"]]=0.2
theta0[["tau2"]]=0.2
theta0[["wane"]]=0.1
theta=theta0
vp1=0.05 #probability individual infection history resampled
#run_mcmc(test.yr=2010,runs=10000,hist.true=NULL,varpart_prob=vp1,test_years,inf_years,strain_years,n_part,test.list,theta0,switch1=2)
#historytabSim
run_mcmc(test.yr=2011,runs=5000,hist.true=NULL,varpart_prob=vp1,test_years,inf_years,strain_years,n_part,test.list,theta0,switch1=2)
# Plot posteriors and compare to simulation
simDat=FALSE
source("simulation_diagnostics.R",local=TRUE)
